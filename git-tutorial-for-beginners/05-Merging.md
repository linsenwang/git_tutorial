# 5. 合并分支

当你完成了在一个分支上的开发工作（比如一个新功能或一个 bug 修复），下一步就是将这些更改整合回主开发分支（例如 `main`）。这个过程叫做**合并**（Merge）。

---

## `git merge`：合并分支

`git merge` 命令会将指定分支的历史记录合并到当前分支。

**合并的基本流程**:

1.  **切换到接收更改的分支**。
    通常是 `main` 或 `master` 分支。确保这个分支是最新的。
    ```bash
    # 切换到 main 分支
    git checkout main

    # (如果是协作项目) 拉取远程仓库的最新更改
    # git pull origin main
    ```

2.  **运行 `git merge` 命令**，指定你想要合并过来的分支。
    ```bash
    # 假设你的功能分支叫做 feature-login
    git merge feature-login
    ```

Git 会尝试自动合并这些更改。在大多数情况下，如果不同分支修改的是不同文件的不同部分，合并会顺利完成。这被称为 **Fast-forward (快进) 合并**或**三方合并**。

3.  **（可选）删除已经合并的分支**。
    在功能分支被成功合并后，通常会将其删除，以保持仓库的整洁。
    ```bash
    git branch -d feature-login
    ```

---

## 理解并解决合并冲突

**什么是合并冲突 (Merge Conflict)？**

当你试图合并的两个分支，对**同一个文件**的**同一部分**进行了不同的修改时，Git 无法自动判断应该保留哪个版本。这时，Git 会停止合并，并告诉你发生了**冲突**，需要你手动解决。

**如何解决冲突**:

1.  **识别冲突文件**。
    运行 `git status`，Git 会清晰地告诉你哪些文件存在冲突 (`Unmerged paths`)。

2.  **打开冲突文件**。
    你会看到类似下面这样的标记，被插入到你的文件中：

    ```
    <<<<<<< HEAD
    这里是当前分支 (main) 的内容
    =======
    这里是你要合并过来的分支 (feature-login) 的内容
    >>>>>>> feature-login
    ```

    *   `<<<<<<< HEAD` 到 `=======` 之间是**当前分支**（你执行 merge 命令时所在的分支，通常是 `main`）的内容。
    *   `=======` 到 `>>>>>>> branch-name` 之间是**你正在合并过来**的分支的内容。

3.  **手动编辑文件，决定最终内容**。
    你需要：
    *   删除 Git 添加的特殊标记 (`<<<<<<<`, `=======`, `>>>>>>>`)。
    *   根据你的需求，决定保留哪部分代码，或者将两部分代码结合起来。
    *   最终文件应该只包含你希望保留的最终代码。

    例如，你可能决定保留新分支的更改，并删除旧的：
    ```
    这里是你要合并过来的分支 (feature-login) 的内容
    ```

4.  **暂存已解决的文件**。
    在你手动解决了文件中的所有冲突后，使用 `git add` 来告诉 Git "我已经解决了这个文件的冲突"。
    ```bash
    git add <conflicted-file-name>
    ```

5.  **完成合并提交**。
    当你解决了所有冲突并暂存了所有冲突文件后，运行 `git commit` 来完成这次合并。
    ```bash
    # 注意，不要带 -m 选项
    git commit
    ```
    Git 会弹出一个预设好的提交信息，通常是 "Merge branch 'branch-name'"，你直接保存并关闭编辑器即可。

解决合并冲突是 Git 中一项非常重要的技能。虽然一开始可能觉得有点吓人，但只要理解了流程，就会变得很简单。
